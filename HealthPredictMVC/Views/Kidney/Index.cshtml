@model KidneyViewModel
@{
    ViewData["Title"] = "Chronic Kidney Disease Assessment";
}

<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <div class="page-header-icon">
            <i class="fas fa-kidneys"></i>
        </div>
        <h1>Chronic Kidney Disease Assessment</h1>
        <p class="mb-0" style="color: rgba(255,255,255,0.9);">
            Evaluate kidney health based on blood, urine, and clinical parameters
        </p>
    </div>
</section>

<div class="container">
    <!-- Disease Overview -->
    <div class="disease-overview">
        <h2>
            <i class="fas fa-info-circle" style="color: var(--primary-light);"></i>
            About Chronic Kidney Disease
        </h2>
        <p>
            Chronic Kidney Disease (CKD) is a progressive condition where the kidneys gradually lose their ability to filter
            waste and excess fluids from the blood. Risk factors include diabetes, hypertension, family history, and age.
            Early detection through blood and urine tests can help slow progression and prevent complications like kidney failure.
        </p>
    </div>

    <!-- Feature Explanations -->
    <div class="feature-explanations">
        <h3>
            <i class="fas fa-clipboard-list me-2"></i>
            Understanding the Kidney Health Parameters
        </h3>
        <p class="text-secondary mb-4">
            These blood, urine, and clinical values help assess your kidney health:
        </p>

        <div class="row">
            <div class="col-md-6">
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-tint"></i></div>
                    <div class="feature-content">
                        <div class="feature-name">Specific Gravity</div>
                        <p class="feature-description">Measures urine concentration. Abnormal values may indicate kidney's inability to concentrate urine.</p>
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-flask"></i></div>
                    <div class="feature-content">
                        <div class="feature-name">Albumin & Sugar Levels</div>
                        <p class="feature-description">Albumin in urine (proteinuria) and sugar indicate kidney filtering problems.</p>
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-vial"></i></div>
                    <div class="feature-content">
                        <div class="feature-name">Serum Creatinine & Blood Urea</div>
                        <p class="feature-description">Key markers of kidney function. Elevated levels indicate reduced kidney filtration.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-heartbeat"></i></div>
                    <div class="feature-content">
                        <div class="feature-name">Blood Pressure</div>
                        <p class="feature-description">Hypertension is both a cause and consequence of kidney disease.</p>
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-dna"></i></div>
                    <div class="feature-content">
                        <div class="feature-name">Hemoglobin & Red Blood Cells</div>
                        <p class="feature-description">Kidneys produce erythropoietin; CKD often causes anemia with low hemoglobin.</p>
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-balance-scale"></i></div>
                    <div class="feature-content">
                        <div class="feature-name">Sodium & Potassium</div>
                        <p class="feature-description">Electrolyte imbalances are common in kidney disease and can be dangerous.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Prediction Form -->
    <div class="prediction-form">
        <h3>
            <i class="fas fa-edit me-2"></i>
            Enter Your Kidney Health Parameters
        </h3>

        <form asp-action="Index" method="post">
            @Html.AntiForgeryToken()

            <div class="form-grid">
                <div class="form-group">
                    <label asp-for="Input.Age" class="form-label">Age <span class="unit">(years)</span></label>
                    <input asp-for="Input.Age" class="form-control" type="number" min="1" max="120" />
                    <span asp-validation-for="Input.Age" class="validation-message"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Input.BP" class="form-label">Blood Pressure <span class="unit">(mm Hg)</span></label>
                    <input asp-for="Input.BP" class="form-control" type="number" min="40" max="200" />
                    <span asp-validation-for="Input.BP" class="validation-message"></span>
                    <small class="form-text">Normal: 80 mm Hg (diastolic)</small>
                </div>

                <div class="form-group">
                    <label asp-for="Input.SG" class="form-label">Specific Gravity</label>
                    <select asp-for="Input.SG" class="form-control form-select">
                        <option value="1.005">1.005</option>
                        <option value="1.010">1.010</option>
                        <option value="1.015">1.015</option>
                        <option value="1.020" selected>1.020</option>
                        <option value="1.025">1.025</option>
                    </select>
                    <span asp-validation-for="Input.SG" class="validation-message"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Input.AL" class="form-label">Albumin Level <span class="unit">(0-5)</span></label>
                    <select asp-for="Input.AL" class="form-control form-select">
                        <option value="0">0 - None</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 - High</option>
                    </select>
                    <span asp-validation-for="Input.AL" class="validation-message"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Input.SU" class="form-label">Sugar Level <span class="unit">(0-5)</span></label>
                    <select asp-for="Input.SU" class="form-control form-select">
                        <option value="0">0 - None</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 - High</option>
                    </select>
                    <span asp-validation-for="Input.SU" class="validation-message"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Input.RBC" class="form-label">Red Blood Cells</label>
                    <select asp-for="Input.RBC" class="form-control form-select">
                        <option value="1">Normal</option>
                        <option value="0">Abnormal</option>
                    </select>
                </div>

                <div class="form-group">
                    <label asp-for="Input.PC" class="form-label">Pus Cells</label>
                    <select asp-for="Input.PC" class="form-control form-select">
                        <option value="1">Normal</option>
                        <option value="0">Abnormal</option>
                    </select>
                </div>

                <div class="form-group">
                    <label asp-for="Input.PCC" class="form-label">Pus Cell Clumps</label>
                    <select asp-for="Input.PCC" class="form-control form-select">
                        <option value="0">Not Present</option>
                        <option value="1">Present</option>
                    </select>
                </div>

                <div class="form-group">
                    <label asp-for="Input.BA" class="form-label">Bacteria</label>
                    <select asp-for="Input.BA" class="form-control form-select">
                        <option value="0">Not Present</option>
                        <option value="1">Present</option>
                    </select>
                </div>

                <div class="form-group">
                    <label asp-for="Input.BGR" class="form-label">Blood Glucose Random <span class="unit">(mg/dL)</span></label>
                    <input asp-for="Input.BGR" class="form-control" type="number" min="20" max="500" />
                    <span asp-validation-for="Input.BGR" class="validation-message"></span>
                    <small class="form-text">Normal: 70-140 mg/dL</small>
                </div>

                <div class="form-group">
                    <label asp-for="Input.BU" class="form-label">Blood Urea <span class="unit">(mg/dL)</span></label>
                    <input asp-for="Input.BU" class="form-control" type="number" step="0.1" min="1" max="400" />
                    <span asp-validation-for="Input.BU" class="validation-message"></span>
                    <small class="form-text">Normal: 7-20 mg/dL</small>
                </div>

                <div class="form-group">
                    <label asp-for="Input.SC" class="form-label">Serum Creatinine <span class="unit">(mg/dL)</span></label>
                    <input asp-for="Input.SC" class="form-control" type="number" step="0.1" min="0.1" max="20" />
                    <span asp-validation-for="Input.SC" class="validation-message"></span>
                    <small class="form-text">Normal: 0.7-1.3 mg/dL</small>
                </div>

                <div class="form-group">
                    <label asp-for="Input.SOD" class="form-label">Sodium <span class="unit">(mEq/L)</span></label>
                    <input asp-for="Input.SOD" class="form-control" type="number" step="0.1" min="100" max="165" />
                    <span asp-validation-for="Input.SOD" class="validation-message"></span>
                    <small class="form-text">Normal: 136-145 mEq/L</small>
                </div>

                <div class="form-group">
                    <label asp-for="Input.POT" class="form-label">Potassium <span class="unit">(mEq/L)</span></label>
                    <input asp-for="Input.POT" class="form-control" type="number" step="0.1" min="2" max="10" />
                    <span asp-validation-for="Input.POT" class="validation-message"></span>
                    <small class="form-text">Normal: 3.5-5.0 mEq/L</small>
                </div>

                <div class="form-group">
                    <label asp-for="Input.HEMO" class="form-label">Hemoglobin <span class="unit">(g/dL)</span></label>
                    <input asp-for="Input.HEMO" class="form-control" type="number" step="0.1" min="3" max="20" />
                    <span asp-validation-for="Input.HEMO" class="validation-message"></span>
                    <small class="form-text">Normal: 12-17 g/dL</small>
                </div>

                <div class="form-group">
                    <label asp-for="Input.PCV" class="form-label">Packed Cell Volume <span class="unit">(%)</span></label>
                    <input asp-for="Input.PCV" class="form-control" type="number" step="0.1" min="10" max="55" />
                    <span asp-validation-for="Input.PCV" class="validation-message"></span>
                    <small class="form-text">Normal: 36-46%</small>
                </div>

                <div class="form-group">
                    <label asp-for="Input.WC" class="form-label">White Blood Cell Count <span class="unit">(cells/cumm)</span></label>
                    <input asp-for="Input.WC" class="form-control" type="number" min="2000" max="30000" />
                    <span asp-validation-for="Input.WC" class="validation-message"></span>
                    <small class="form-text">Normal: 4500-11000</small>
                </div>

                <div class="form-group">
                    <label asp-for="Input.RC" class="form-label">Red Blood Cell Count <span class="unit">(millions/cmm)</span></label>
                    <input asp-for="Input.RC" class="form-control" type="number" step="0.1" min="2" max="8" />
                    <span asp-validation-for="Input.RC" class="validation-message"></span>
                    <small class="form-text">Normal: 4.5-5.5</small>
                </div>

                <div class="form-group">
                    <label asp-for="Input.HTN" class="form-label">Hypertension</label>
                    <select asp-for="Input.HTN" class="form-control form-select">
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>

                <div class="form-group">
                    <label asp-for="Input.DM" class="form-label">Diabetes Mellitus</label>
                    <select asp-for="Input.DM" class="form-control form-select">
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>

                <div class="form-group">
                    <label asp-for="Input.CAD" class="form-label">Coronary Artery Disease</label>
                    <select asp-for="Input.CAD" class="form-control form-select">
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>

                <div class="form-group">
                    <label asp-for="Input.APPET" class="form-label">Appetite</label>
                    <select asp-for="Input.APPET" class="form-control form-select">
                        <option value="1">Good</option>
                        <option value="0">Poor</option>
                    </select>
                </div>

                <div class="form-group">
                    <label asp-for="Input.PE" class="form-label">Pedal Edema</label>
                    <select asp-for="Input.PE" class="form-control form-select">
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>

                <div class="form-group">
                    <label asp-for="Input.ANE" class="form-label">Anemia</label>
                    <select asp-for="Input.ANE" class="form-control form-select">
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn-predict">
                    <i class="fas fa-kidneys"></i>
                    Analyze Kidney Health
                </button>
            </div>
        </form>

        <!-- Result Display -->
        @if (Model.Result != null)
        {
            <div id="results" class="result-card @(Model.Result.Success ? (Model.Result.Prediction == 1 ? "positive" : "negative") : "error")">
                @if (Model.Result.Success)
                {
                    <div class="result-header">
                        <div class="result-icon">
                            @if (Model.Result.Prediction == 1)
                            {
                                <i class="fas fa-exclamation-triangle"></i>
                            }
                            else
                            {
                                <i class="fas fa-check-circle"></i>
                            }
                        </div>
                        <div>
                            <h3 class="result-title">
                                @(Model.Result.Prediction == 1 ? "At Risk for Chronic Kidney Disease" : "Kidney Function Appears Normal")
                            </h3>
                            <span class="risk-badge @Model.Result.RiskLevel.ToLower()">
                                @Model.Result.RiskLevel Risk
                            </span>
                        </div>
                    </div>

                    <p>@Model.Result.Message</p>

                    <div class="result-details">
                        <div class="result-metric">
                            <div class="result-metric-label">Confidence</div>
                            <div class="result-metric-value">
                                @if (Model.Result.Prediction == 0)
                                {
                                    @((100 - Model.Result.Probability).ToString("F1"))@:%
                                }
                                else
                                {
                                    @Model.Result.Probability.ToString("F1")@:%
                                }
                            </div>
                        </div>
                        <div class="result-metric">
                            <div class="result-metric-label">Risk Level</div>
                            <div class="result-metric-value">@Model.Result.RiskLevel</div>
                        </div>
                        <div class="result-metric">
                            <div class="result-metric-label">Assessment</div>
                            <div class="result-metric-value">Renal</div>
                        </div>
                    </div>
                }
                else
                {
                    <div class="result-header">
                        <div class="result-icon" style="background: var(--warning-yellow);">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div>
                            <h3 class="result-title" style="color: var(--warning-yellow);">Analysis Error</h3>
                        </div>
                    </div>
                    <p>@Model.Result.Error</p>
                }
            </div>
        }
    </div>

    <!-- Medical Disclaimer -->
    <div class="medical-disclaimer">
        <div class="medical-disclaimer-title">
            <i class="fas fa-exclamation-triangle"></i>
            Medical Disclaimer
        </div>
        <p>
            This kidney disease assessment provides informational insights only and is <strong>not a medical diagnosis</strong>.
            The results are based on machine learning analysis of the Chronic Kidney Disease Dataset. Please consult a
            nephrologist for proper kidney evaluation and treatment of any kidney-related concerns.
        </p>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    @if (Model.Result != null)
    {
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                document.getElementById("results").scrollIntoView({ behavior: "smooth", block: "center" });
            });
        </script>
    }
}
